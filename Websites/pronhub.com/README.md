# Pornhub 视频采集工具

## 功能概述

这是一个功能丰富的Pornhub视频采集工具，支持视频信息采集、文件下载、数据库存储和HTML页面生成等功能。

## ✨ 主要功能

### 🎯 核心采集功能
- **智能采集**: 自动采集视频信息、缩略图、预览视频和M3U8链接
- **双重存储**: 同时支持SQLite数据库存储和本地文件存储
- **HTML源码保存**: 自动保存页面HTML源码到专用数据库
- **跳过检测**: 智能跳过已采集的视频，避免重复工作
- **多线程处理**: 支持多线程并发采集，提高效率

### 📊 数据管理
- **分类管理**: 自动提取和存储视频分类信息
- **统计分析**: 提供详细的数据库统计信息
- **数据搜索**: 支持视频标题、上传者等关键词搜索
- **数据导出**: 支持将数据导出为JSON格式

### 🎨 界面优化
- **现代化UI**: 美观的HTML界面，支持响应式设计
- **悬停预览**: 鼠标悬停显示预览视频和播放提示
- **链接美化**: 长链接自动截断显示，保持界面整洁
- **双栏布局**: 信息详情采用双栏布局，提高可读性

### 🔄 重新生成功能
- **HTML重新生成**: 从保存的HTML源码重新生成data目录
- **数据修复**: 自动补齐缺失的缩略图和预览视频
- **批量处理**: 支持批量重新处理历史数据

## 🚀 快速开始

### 环境要求
- Python 3.7+
- Chrome浏览器
- SOCKS5代理 (可选)

### 安装依赖
```bash
pip install -r requirements.txt
```

### 基本使用

#### 1. 采集视频
```bash
# 采集第1页到第5页
python app.py 1 5

# 采集第10页（单页）
python app.py 10 1

# 采集所有页面（从第1页开始）
python app.py
```

#### 2. 查看统计信息
```bash
python app.py --stats
```

#### 3. 搜索视频
```bash
# 搜索包含"学妹"的视频，显示前10条
python app.py --search "学妹" 10
```

#### 4. 查看最近采集的视频
```bash
# 显示最近采集的20个视频
python app.py --recent 20
```

#### 5. 导出数据
```bash
# 导出所有数据到JSON文件
python app.py --export videos.json

# 导出前100条数据
python app.py --export videos.json 100
```

#### 6. 重新生成data目录
```bash
# 从HTML数据库重新生成data目录（前10个页面）
python app.py --regenerate 10

# 重新生成所有页面（包括更新已存在的）
python app.py --regenerate --update
```

## 📁 文件结构

```
Websites/pronhub.com/
├── app.py                    # 主程序文件
├── config.py                 # 配置文件
├── requirements.txt          # 依赖包列表
├── README.md                # 说明文档
├── database/                 # 数据库目录
│   ├── pornhub_videos.db    # 视频数据库
│   └── pornhub.com.html.db  # HTML源码数据库
└── data/                    # 采集数据目录
    └── [视频ID]/            # 各视频的文件夹
        ├── index.html       # 视频展示页面
        ├── thumbnail.jpg    # 缩略图
        ├── preview.webm     # 预览视频
        └── collection_log.txt # 采集日志
```

## ⚙️ 配置说明

主要配置项在 `config.py` 文件中：

```python
# 采集配置
SCRAPER_CONFIG = {
    'download_threads': 10,      # 下载线程数
    'skip_existing': True,       # 是否跳过已存在的视频
    'auto_detect_last': True,    # 是否自动检测最后一页
}

# 详情页采集配置
DETAIL_PAGE_CONFIG = {
    'use_requests': True,        # 使用requests模式（推荐）
    'max_workers_requests': 5,   # requests模式工作线程数
    'max_workers_selenium': 3,   # Selenium模式工作线程数
}

# 调试设置
DEBUG = {
    'verbose': False,            # 详细输出
    'save_raw_html': False,      # 保存原始HTML
}
```

## 🎨 界面特色

### 美化效果
- **渐变背景**: 现代化的渐变色背景
- **毛玻璃效果**: 半透明容器配合毛玻璃效果
- **动画效果**: 悬停动画和脉冲效果
- **响应式设计**: 自适应不同屏幕尺寸

### 交互体验
- **悬停预览**: 鼠标悬停缩略图显示预览视频
- **点击播放**: 点击缩略图打开最高清视频
- **链接截断**: 长链接自动显示省略号
- **双栏信息**: 视频信息采用双栏布局

## 📊 数据库设计

### 视频数据库 (pornhub_videos.db)
- **videos**: 视频基本信息
- **categories**: 分类信息
- **video_categories**: 视频-分类关联表
- **m3u8_urls**: M3U8链接表

### HTML数据库 (pornhub.com.html.db)
- **html_pages**: 存储页面HTML源码
  - `url`: 页面URL (唯一)
  - `html_content`: HTML源码
  - `created_at`: 采集时间
  - `updated_at`: 更新时间

## 🔧 高级功能

### 重新生成机制
从HTML数据库重新生成data目录的工作流程：
1. 读取HTML数据库中的页面源码
2. 重新解析提取视频信息
3. 下载缺失的缩略图和预览视频
4. 生成美化的HTML展示页面
5. 更新视频数据库信息

### 跳过逻辑
智能跳过策略：
- 优先检查本地文件是否存在
- 如果本地文件存在且数据库有记录，则跳过
- 如果本地文件不存在，即使数据库有记录也会重新处理

### 错误处理
- 网络超时自动重试
- 页面加载失败跳过处理
- 文件下载失败记录日志
- 数据库操作异常恢复

## 📈 性能优化

- **多线程并发**: 支持多线程下载和数据处理
- **资源管理**: 自动管理Selenium WebDriver资源
- **内存优化**: 大文件分块处理，避免内存溢出
- **网络优化**: 支持代理配置，网络请求重试机制

## 🛠️ 故障排除

### 常见问题

1. **网络连接失败**
   - 检查代理配置
   - 确认网络连接正常

2. **ChromeDriver错误**
   - 确保Chrome浏览器已安装
   - 检查ChromeDriver版本兼容性

3. **文件下载失败**
   - 检查磁盘空间
   - 确认写入权限

4. **数据库错误**
   - 检查数据库文件权限
   - 确认SQLite版本兼容性

## 📜 更新日志

### v2.0.0 (最新)
- ✨ 新增HTML源码数据库存储
- 🎨 全面重构界面设计，现代化UI
- 🔄 新增从HTML数据库重新生成功能
- 📊 优化统计信息显示
- 🐛 修复分类数据采集问题
- 💫 优化悬停交互体验

### v1.0.0
- 🎯 基础视频采集功能
- 💾 SQLite数据库存储
- 📁 本地文件管理
- 🔍 搜索和统计功能

## 📄 许可证

本项目仅供学习和研究使用，请遵守相关法律法规和网站使用条款。

---

**注意**: 使用本工具时请遵守目标网站的robots.txt和使用条款，合理控制采集频率，避免对服务器造成过大负载。 